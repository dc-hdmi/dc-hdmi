<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>아이템 먹기 게임</title>
<style>
    body {
        margin: 0;
        background: #222;
        color: white;
        font-family: sans-serif;
        overflow: hidden;
    }
    #game {
        position: relative;
        margin: 0 auto;
        background: #333;
        width: 500px;
        height: 600px;
        border: 2px solid #555;
        touch-action: none;
    }
    .player {
        position: absolute;
        bottom: 10px;
        left: 230px;
        width: 60px;
        height: 60px;
        /* background: cyan; */
        background-image: url('ship.png');
	    background-size: cover;
	    background-position: center;
        border-radius: 5px;
    }
    .item {
        position: absolute;
        width: 45px;
        height: 45px;
        text-align: center;
        line-height: 45px;
        font-weight: bold;
        font-size: 20px;
        color: white;
        border-radius: 50%;
        background-size: cover;
        background-position: center;
    }

    /* 점수별 아이템 색상/이미지 */
    .item-p1 { background-color: red; }
    .item-p2 { background-color: orange; }
    .item-p3 { background-color: yellow; color: black; }
    .item-p4 { background-color: green; }
    .item-p5 { background-color: blue; }
    .item-n1 { background-color: gray; }
    .item-n2 { background-color: black; }

    /* 이미지로 바꾸고 싶을 경우 예시 */
    /*
    .item-p1 { background-image: url('p1.png'); }
    .item-p2 { background-image: url('p2.png'); }
    .item-p3 { background-image: url('p3.png'); }
    .item-p4 { background-image: url('p4.png'); }
    .item-p5 { background-image: url('p5.png'); }
    .item-n1 { background-image: url('n1.png'); }
    .item-n2 { background-image: url('n2.png'); }
    */
    #score, #timer {
        text-align: center;
        font-size: 20px;
        margin: 5px;
    }
    #controls {
        text-align: center;
        margin: 10px;
    }
    button {
        padding: 8px 16px;
        font-size: 16px;
        cursor: pointer;
        border: none;
        border-radius: 6px;
    }
    #startBtn { background: green; color: white; }
    #restartBtn { background: orange; color: white; }
</style>
</head>
<body>
<div id="score">점수: 0</div>
<div id="timer">남은 시간: 180초</div>
<div id="controls">
    <button id="startBtn">게임 시작</button>
    <button id="restartBtn" style="display:none;">재시작</button>
</div>
<div id="game">
    <div class="player" id="player"></div>
</div>

<script>
const game = document.getElementById("game");
const player = document.getElementById("player");
const scoreEl = document.getElementById("score");
const timerEl = document.getElementById("timer");
const startBtn = document.getElementById("startBtn");
const restartBtn = document.getElementById("restartBtn");

let score = 0;
let playerX = 230;
let gameRunning = false;
let timeLeft = 180;
let timerInterval;
let fallSpeed = 3;
let speedUpInterval;

const items = [
    { value: 1, class: "item-p1" },
    { value: 2, class: "item-p2" },
    { value: 3, class: "item-p3" },
    { value: 4, class: "item-p4" },
    { value: 5, class: "item-p5" },
    { value: -5, class: "item-n1" },
    { value: -10, class: "item-n2" }
];

// 아이템 생성
function createItem() {
    const itemData = items[Math.floor(Math.random() * items.length)];
    const item = document.createElement("div");
    item.className = "item " + itemData.class;
    item.style.left = Math.random() * (game.clientWidth - 30) + "px";
    item.style.top = "0px";
    item.textContent = itemData.value;
    item.dataset.value = itemData.value;
    game.appendChild(item);
}

// 게임 루프
function gameLoop() {
    if (!gameRunning) return;

    if (Math.random() < 0.03) createItem();

    const allItems = document.querySelectorAll(".item");
    allItems.forEach(item => {
        let y = parseFloat(item.style.top);
        y += fallSpeed;
        item.style.top = y + "px";

        const px = playerX;
        const py = game.clientHeight - player.clientHeight - 10;
        const ix = parseFloat(item.style.left);
        const iy = y;
        if (
            ix < px + player.clientWidth &&
            ix + 30 > px &&
            iy < py + player.clientHeight &&
            iy + 30 > py
        ) {
            score += parseInt(item.dataset.value);
            scoreEl.textContent = "점수: " + score;
            item.remove();

            if (score < 0) {
                endGame(false, true);
            }
        }
        if (y > game.clientHeight) item.remove();
    });

    requestAnimationFrame(gameLoop);
}

// 타이머 시작
function startTimer() {
    timerInterval = setInterval(() => {
        if (!gameRunning) return;
        timeLeft--;
        timerEl.textContent = `남은 시간: ${timeLeft}초`;
        if (timeLeft <= 0) {
            endGame(true);
        }
    }, 1000);
}

// 속도 증가 타이머
function startSpeedUp() {
    speedUpInterval = setInterval(() => {
        if (!gameRunning) return;
        fallSpeed += 1;
    }, 20000);
}

// 게임 시작
function startGame() {
    score = 0;
    scoreEl.textContent = "점수: 0";
    timeLeft = 180;
    timerEl.textContent = `남은 시간: ${timeLeft}초`;
    document.querySelectorAll(".item").forEach(el => el.remove());
    fallSpeed = 3;

    gameRunning = true;
    startBtn.style.display = "none";
    restartBtn.style.display = "inline-block";

    startTimer();
    startSpeedUp();
    gameLoop();
}

// 게임 종료
function endGame(timeOver = false, negativeScore = false) {
    gameRunning = false;
    clearInterval(timerInterval);
    clearInterval(speedUpInterval);

    if (negativeScore) {
        alert(`게임 종료! 점수가 0 미만입니다. 최종 점수: ${score}`);
    } else if (timeOver) {
        alert(`시간 초과! 최종 점수: ${score}`);
    } else {
        alert(`게임 종료! 최종 점수: ${score}`);
    }

    restartBtn.style.display = "none";
    startBtn.style.display = "inline-block";
}

// 마우스 드래그 이동
let isDragging = false;

game.addEventListener("pointerdown", (e) => {
    isDragging = true;
    movePlayer(e.clientX);
});
game.addEventListener("pointermove", (e) => {
    if (isDragging) {
        movePlayer(e.clientX);
    }
});
document.addEventListener("pointerup", () => {
    isDragging = false;
});

function movePlayer(clientX) {
    const rect = game.getBoundingClientRect();
    let newX = clientX - rect.left - player.clientWidth / 2;
    newX = Math.max(0, Math.min(newX, game.clientWidth - player.clientWidth));
    playerX = newX;
    player.style.left = playerX + "px";
}

// 버튼 이벤트
startBtn.addEventListener("click", () => startGame());
restartBtn.addEventListener("click", () => startGame());

//터치로 인한 움직임 막기
game.addEventListener("touchstart", e => {
    e.preventDefault(); // 터치 시작 시 아무것도 하지 않음
}, { passive: false });

game.addEventListener("touchmove", e => {
    e.preventDefault(); // 드래그처럼 따라오는 것도 막음
}, { passive: false });
</script>
</body>
</html>
