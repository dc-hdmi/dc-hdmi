<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="common/libs/js/jquery.min.js"></script>
<title>아이템 먹기 게임</title>
<style>
    body {
        margin: 0;
        background: #222;
        color: white;
        font-family: sans-serif;
        overflow: hidden;
    }
    #game {
	    position: relative;
	    margin: 0 auto;
	    background: #333;
	    width: 100vw;
	    height: calc(100vh - 120px); /* 상단 점수, 버튼 높이 고려 */
	    border: 2px solid #555;
	    touch-action: none;
	}
    .player {
	    position: absolute;
	    bottom: 90px; /* 기존 10px → 드래그 영역 위로 이동 */
	    left: 230px;
	    width: 60px;
	    height: 60px;
	    background-image: url('ship.png');
	    background-size: cover;
	    background-position: center;
	    border-radius: 5px;
	    z-index: 2; /* 드래그 영역보다 위에 보이게 */
	}
    .item {
        position: absolute;
        width: 45px;
        height: 45px;
        text-align: center;
        line-height: 45px;
        font-weight: bold;
        font-size: 20px;
        color: white;
        border-radius: 50%;
        background-size: cover;
        background-position: center;
    }
    .game-item {
        position: absolute;
        width: 45px;
        height: 45px;
        text-align: center;
        line-height: 45px;
        font-weight: bold;
        font-size: 20px;
        color: white;
        border-radius: 50%;
        background-size: cover;
        background-position: center;
    }

    /* 점수별 아이템 색상/이미지 */
    /* .item-p1 { background-color: red; }
    .item-p2 { background-color: orange; }
    .item-p3 { background-color: yellow; color: black; }
    .item-p4 { background-color: green; }
    .item-p5 { background-color: blue; } */
    .item-p1 { 
    	width: 45px; /* 원래의 절반 */
	  	height: 45px;
	  	background-image: url('item.png');
	  	background-position: -141.75px -159px;
	  	background-repeat: no-repeat;
	  	background-size: 256px 256px;
	}
	.item-p2 { 
		width: 45px; /* 원래의 절반 */
	  	height: 45px;
	  	background-image: url('item.png');
	  	background-position: 0px 2px;
	  	background-repeat: no-repeat;
	  	background-size: 256px 256px;
	}
	.item-p3 { 
		width: 45px; /* 원래의 절반 */
	  	height: 45px;
	  	background-image: url('item.png');
	  	background-position: -112.50px -40px;
	  	background-repeat: no-repeat;
	  	background-size: 256px 256px;
	}
	.item-p4 { 
		width: 45px; /* 원래의 절반 */
	  	height: 45px;
	  	background-image: url('item.png');
	  	background-position: -95.75px -180px;
	  	background-repeat: no-repeat;
	  	background-size: 256px 256px;
	}
	.item-p5 { 
		width: 45px; /* 원래의 절반 */
	  	height: 45px;
	  	background-image: url('item.png');
	  	background-position: -35.75px -90px;
	  	background-repeat: no-repeat;
	  	background-size: 256px 256px;
	}
	.item-n1 { 
		width: 45px; /* 원래의 절반 */
	  	height: 45px;
	  	background-image: url('item.png');
	  	background-position: -49.75px 2px;
	  	background-repeat: no-repeat;
	  	background-size: 256px 256px;
	}
	.item-n2 { 
		width: 45px; /* 원래의 절반 */
	  	height: 45px;
	  	background-image: url('item.png');
	  	background-position: 6px -90px;
	  	background-repeat: no-repeat;
	  	background-size: 256px 256px;
	}
	
    .item-tp1 { 
    	width: 45px; /* 원래의 절반 */
	  	height: 45px;
	  	background-image: url('item.png');
	  	background-position: -141.75px -159px;
	  	background-repeat: no-repeat;
	  	background-size: 256px 256px;
	}
	.item-tp2 { 
		width: 45px; /* 원래의 절반 */
	  	height: 45px;
	  	background-image: url('item.png');
	  	background-position: 0px 2px;
	  	background-repeat: no-repeat;
	  	background-size: 256px 256px;
	}
	.item-tp3 { 
		width: 45px; /* 원래의 절반 */
	  	height: 45px;
	  	background-image: url('item.png');
	  	background-position: -112.50px -40px;
	  	background-repeat: no-repeat;
	  	background-size: 256px 256px;
	}
	.item-tp4 { 
		width: 45px; /* 원래의 절반 */
	  	height: 45px;
	  	background-image: url('item.png');
	  	background-position: -95.75px -180px;
	  	background-repeat: no-repeat;
	  	background-size: 256px 256px;
	}
	.item-tp5 { 
		width: 45px; /* 원래의 절반 */
	  	height: 45px;
	  	background-image: url('item.png');
	  	background-position: -35.75px -90px;
	  	background-repeat: no-repeat;
	  	background-size: 256px 256px;
	}
	.item-tn1 { 
		width: 45px; /* 원래의 절반 */
	  	height: 45px;
	  	background-image: url('item.png');
	  	background-position: -49.75px 2px;
	  	background-repeat: no-repeat;
	  	background-size: 256px 256px;
	}
	.item-tn2 { 
		width: 45px; /* 원래의 절반 */
	  	height: 45px;
	  	background-image: url('item.png');
	  	background-position: 6px -90px;
	  	background-repeat: no-repeat;
	  	background-size: 256px 256px;
	}

    #score, #timer {
        text-align: center;
        font-size: 20px;
        margin: 5px;
    }
    #controls {
        text-align: center;
        margin: 10px;
    }
    button {
        padding: 8px 16px;
        font-size: 16px;
        cursor: pointer;
        border: none;
        border-radius: 6px;
    }
    #startBtn { background: green; color: white; }
    #drag-area {
	    position: absolute;
	    bottom: 0;
	    left: 0;
	    width: 100%;
	    height: 80px;
	    background: rgba(255, 255, 255, 0.07);
	    z-index: 1; 
	    display: flex;
	    justify-content: center;
	    align-items: center;
	    font-size: 18px;
	    color: #ccc;
	    user-select: none;
	    touch-action: none;
	    border-top: 1px solid rgba(255, 255, 255, 0.1);
	}
	#item-preview {
	  position: absolute;
	  top: 50%;
	  left: 50%;
	  transform: translate(-50%, -50%);
	  border-collapse: collapse;
	  z-index: 999;
	  width: 335px;
	  height: 110px;
	  text-align: center;
	  background: rgba(0, 0, 0, 0.5); /* 배경 살짝 투명하게 보기 좋게 */
	  padding: 10px;
	  border-radius: 10px;
	}
	#item-preview td {
	  padding: 2px;
	}
	.hidden {
	  display: none !important;
	}
</style>
</head>
<body>
<div id="current-time" style="position: absolute; top: 10px; right: 10px; font-size: 16px; z-index: 1000;"></div>
<div id="preview">
	<table id="item-preview">
	  <tr>
	    <td><div class="item item-p1"></div></td>
	    <td><div class="item item-tp2"></div></td>
	    <td><div class="item item-tp3"></div></td>
	    <td><div class="item item-tp4"></div></td>
	    <td><div class="item item-tp5"></div></td>
	    <td><div class="item item-tn1"></div></td>
	    <td><div class="item item-tn2"></div></td>
	  </tr>
	  <tr>
	    <td>1점</td>
	    <td>2점</td>
	    <td>3점</td>
	    <td>4점</td>
	    <td>5점</td>
	    <td><span style="margin-left: -5px;">-5점</span></td>
	    <td><span style="margin-left: -5px;">-10점</span></td>
	  </tr>
	</table>
</div>
<div id="score">점수: 0</div>
<div id="timer">남은 시간: 60초</div>
<div id="controls">
    <button id="startBtn">게임 시작</button>
</div>
<div id="game">
    <div class="player" id="player"></div>
    <div id="drag-area">
	  <span>← 드래그 →</span>
	</div>
</div>

<script>
const game = document.getElementById("game");
const player = document.getElementById("player");
const dragArea = document.getElementById("drag-area");
const scoreEl = document.getElementById("score");
const timerEl = document.getElementById("timer");
const startBtn = document.getElementById("startBtn");

let score = 0;
let playerX = (game.clientWidth - player.clientWidth) / 2;
let gameRunning = false;
let timeLeft = 60;
let timerInterval;
let fallSpeed = 3;
let speedUpInterval;

const items = [
    { value: 1, class: "item-p1" },
    { value: 2, class: "item-p2" },
    { value: 3, class: "item-p3" },
    { value: 4, class: "item-p4" },
    { value: 5, class: "item-p5" },
    { value: -5, class: "item-n1" },
    { value: -10, class: "item-n2" }
];

function centerPlayer() {
    playerX = (game.clientWidth - player.clientWidth) / 2;
    player.style.left = playerX + "px";
}

// 아이템 생성
function createItem() {
    const itemData = items[Math.floor(Math.random() * items.length)];
    const item = document.createElement("div");
    item.className = "game-item " + itemData.class;
    item.style.left = Math.random() * (game.clientWidth - 30) + "px";
    item.style.top = "0px";
    item.textContent = itemData.value;
    item.dataset.value = itemData.value;
    game.appendChild(item);
}

// 게임 루프
function gameLoop() {
    if (!gameRunning) return;

    if (Math.random() < 0.03) createItem();

    const allItems = game.querySelectorAll(".game-item");
    allItems.forEach(item => {
    	
    	if (item.closest("#item-preview")) return;
    	
        let y = parseFloat(item.style.top);
        y += fallSpeed;
        item.style.top = y + "px";

        const px = playerX;
        const py = game.clientHeight - player.clientHeight - 10;
        const ix = parseFloat(item.style.left);
        const iy = y;
        if (
            ix < px + player.clientWidth &&
            ix + 30 > px &&
            iy < py + player.clientHeight &&
            iy + 30 > py
        ) {
            score += parseInt(item.dataset.value);
            scoreEl.textContent = "점수: " + score;
            item.remove();

            if (score < 0) {
                endGame(false, true);
            }
        }
        if (y > game.clientHeight) item.remove();
    });

    requestAnimationFrame(gameLoop);
}

// 타이머 시작
function startTimer() {
    timerInterval = setInterval(() => {
        if (!gameRunning) return;
        timeLeft--;
        timerEl.textContent = `남은 시간: ${timeLeft}초`;
        if (timeLeft <= 0) {
            endGame(true);
        }
    }, 1000);
}

// 속도 증가 타이머
function startSpeedUp() {
    speedUpInterval = setInterval(() => {
        if (!gameRunning) return;
        fallSpeed += 1;
    }, 10000);
}

// 게임 시작
function startGame() {
	centerPlayer();
    score = 0;
    scoreEl.textContent = "점수: 0";
    timeLeft = 60;
    timerEl.textContent = `남은 시간: ${timeLeft}초`;
    //document.querySelectorAll(".item").forEach(el => el.remove());
    game.querySelectorAll(".game-item").forEach(el => el.remove());
    fallSpeed = 3;

    gameRunning = true;
    startBtn.style.display = "none";
    $("#preview").hide();

    startTimer();
    startSpeedUp();
    gameLoop();
}

// 게임 종료
function endGame(timeOver = false, negativeScore = false) {
    gameRunning = false;
    clearInterval(timerInterval);
    clearInterval(speedUpInterval);

    if (negativeScore) {
        alert(`게임 종료! 점수가 0 미만입니다. 최종 점수: ${score}`);
    } else if (timeOver) {
        alert(`시간 초과! 최종 점수: ${score}`);
    } else {
        alert(`게임 종료! 최종 점수: ${score}`);
    }

    startBtn.style.display = "inline-block";
    $("#preview").show();
}

// 마우스 드래그 이동
let isDragging = false;

dragArea.addEventListener("pointerdown", (e) => {
    isDragging = true;
    movePlayer(e.clientX);
});
dragArea.addEventListener("pointermove", (e) => {
    if (isDragging) {
        movePlayer(e.clientX);
    }
});
document.addEventListener("pointerup", () => {
    isDragging = false;
});

function movePlayer(clientX) {
    const rect = game.getBoundingClientRect();
    let newX = clientX - rect.left - player.clientWidth / 2;
    newX = Math.max(0, Math.min(newX, game.clientWidth - player.clientWidth));
    playerX = newX;
    player.style.left = playerX + "px";
}

// 버튼 이벤트
startBtn.addEventListener("click", () => startGame());

//터치로 인한 움직임 막기
game.addEventListener("touchstart", e => {
    e.preventDefault(); // 터치 시작 시 아무것도 하지 않음
}, { passive: false });

game.addEventListener("touchmove", e => {
    e.preventDefault(); // 드래그처럼 따라오는 것도 막음
}, { passive: false });

function updateTime() {
    const now = new Date();
    const year = now.getFullYear();
    const month = String(now.getMonth() + 1).padStart(2, "0");
    const date = String(now.getDate()).padStart(2, "0");
    const hours = String(now.getHours()).padStart(2, "0");
    const minutes = String(now.getMinutes()).padStart(2, "0");
    const seconds = String(now.getSeconds()).padStart(2, "0");

    const formattedTime = `${year}-${month}-${date} ${hours}:${minutes}:${seconds}`;
    document.getElementById("current-time").textContent = formattedTime;
}

updateTime();
setInterval(updateTime, 1000);
</script>
</body>
</html>
